# NeoVM 简介

## 什么是 NeoVM？

Neo 虚拟机 (NeoVM) 是一个轻量级的、基于栈的虚拟机，专为在 Neo 区块链上执行智能合约而设计。它提供安全、确定性的执行环境，确保网络中所有节点在处理交易时得到相同的结果。

## 发展历程

NeoVM 最初在 Neo 2.x 中引入，在 Neo N3 中进行了重大改进：

| 特性 | Neo Legacy | Neo N3 |
|------|-----------|--------|
| 指令集 | ~100 操作码 | 200+ 操作码 |
| 异常处理 | 有限 | 完整的 try-catch-finally |
| 调试 | 基础 | 增强的源码映射 |
| 性能 | 良好 | 优化的执行引擎 |

## 主要特点

### 1. 确定性执行

NeoVM 保证相同的合约代码和相同的输入始终产生相同的输出，无论哪个节点执行。这对区块链共识至关重要。

### 2. 沙箱环境

智能合约在完全隔离的环境中运行，无法：
- 访问文件系统
- 直接进行网络调用
- 访问系统资源

所有外部交互都通过受控的互操作服务进行。

### 3. 基于栈的架构

NeoVM 使用两个主要栈：
- **计算栈** - 用于计算和数据操作
- **备用栈** - 用于执行期间的临时存储

### 4. Gas 计量

NeoVM 中的每个操作都消耗 GAS，防止无限循环并确保公平的资源分配。

## NeoVM 在 Neo N3 生态系统中的位置

```
┌─────────────────────────────────────────────┐
│              Neo N3 区块链                   │
├─────────────────────────────────────────────┤
│  ┌─────────────────────────────────────┐    │
│  │           应用层                     │    │
│  │    (智能合约, 去中心化应用)           │    │
│  └─────────────────────────────────────┘    │
│                    ↓                        │
│  ┌─────────────────────────────────────┐    │
│  │           NeoVM 层                   │    │
│  │   • 执行引擎                         │    │
│  │   • 指令处理                         │    │
│  │   • 栈管理                           │    │
│  └─────────────────────────────────────┘    │
│                    ↓                        │
│  ┌─────────────────────────────────────┐    │
│  │          互操作层                    │    │
│  │   • 原生合约                         │    │
│  │   • 系统调用                         │    │
│  │   • 存储访问                         │    │
│  └─────────────────────────────────────┘    │
│                    ↓                        │
│  ┌─────────────────────────────────────┐    │
│  │           账本层                     │    │
│  │   • 区块存储                         │    │
│  │   • 状态管理                         │    │
│  └─────────────────────────────────────┘    │
└─────────────────────────────────────────────┘
```

## 支持的编程语言

Neo N3 智能合约可以使用多种语言编写，最终都编译为 NeoVM 字节码：

- **C#** - 主要语言，拥有完整的 SDK 支持
- **Python** - 通过 neo3-boa 编译器
- **Go** - 通过 NeoGo 编译器
- **Java** - 通过 neow3j 编译器
- **TypeScript** - 通过 Neo-ONE 框架

## 后续内容

在接下来的章节中，我们将探讨：
- NeoVM 的详细架构
- 完整的指令集
- GAS 消耗的计算方式
